<?php

declare(strict_types=1);

/**
 * Phase 4.5: 実践プロジェクト2 - ブログシステム
 *
 * このファイルは、MVCパターンを採用した実践的なブログシステムの実装例です。
 *
 * ## 学習目標
 *
 * 1. **MVCパターン**: モデル・ビュー・コントローラーの分離
 * 2. **認証・認可**: セッションベースの認証とアクセス制御
 * 3. **リレーショナルDB**: 複雑なテーブル設計とリレーション
 * 4. **セキュリティ**: CSRF、XSS、SQLインジェクション対策
 * 5. **検索機能**: 全文検索とフィルタリング
 *
 * ## アーキテクチャ
 *
 * レイヤードアーキテクチャを採用:
 *
 * ```
 * Presentation Layer (Controller)
 *        ↓
 * Application Layer (Service)
 *        ↓
 * Domain Layer (Entity)
 *        ↓
 * Infrastructure Layer (Repository)
 * ```
 *
 * ## 実装機能
 *
 * ### 1. ユーザー管理
 * - ユーザー登録（バリデーション付き）
 * - ログイン/ログアウト
 * - パスワードハッシュ化（ARGON2ID）
 * - セッション管理
 *
 * ### 2. 記事管理
 * - 記事のCRUD操作
 * - 記事のステータス管理（下書き/公開）
 * - スラッグの自動生成
 * - 抜粋の自動生成
 * - 権限チェック（自分の記事のみ編集可能）
 *
 * ### 3. カテゴリー・タグ
 * - カテゴリーとタグの管理
 * - 記事とタグの多対多リレーション
 *
 * ### 4. 検索機能
 * - タイトル・本文での全文検索
 * - カテゴリー・タグでの絞り込み
 *
 * ### 5. セキュリティ
 * - XSS対策（エスケープ関数）
 * - CSRF対策（トークン）
 * - SQLインジェクション対策（プリペアドステートメント）
 * - セッション固定化攻撃対策（session_regenerate_id）
 *
 * ## データベース設計
 *
 * ### テーブル構成
 *
 * - **users**: ユーザー情報
 * - **posts**: 記事情報
 * - **categories**: カテゴリー
 * - **tags**: タグ
 * - **post_tags**: 記事とタグの中間テーブル（多対多）
 * - **comments**: コメント
 *
 * ### リレーション
 *
 * - User 1:N Post（1ユーザーは複数の記事を持つ）
 * - Category 1:N Post（1カテゴリーは複数の記事を持つ）
 * - Post N:M Tag（記事とタグは多対多）
 * - Post 1:N Comment（1記事は複数のコメントを持つ）
 *
 * ## ディレクトリ構造
 *
 * ```
 * BlogSystem/
 * ├── Entities/          エンティティ（ドメインモデル）
 * │   ├── User.php
 * │   ├── Post.php
 * │   ├── Comment.php
 * │   ├── Category.php
 * │   └── Tag.php
 * ├── Repositories/      リポジトリ（データアクセス層）
 * │   ├── UserRepository.php
 * │   ├── PostRepository.php
 * │   └── ...
 * ├── Services/          サービス（ビジネスロジック層）
 * │   ├── AuthService.php
 * │   ├── PostService.php
 * │   └── ...
 * ├── Database.php       データベース接続
 * ├── helpers.php        ヘルパー関数
 * └── BlogApp.php        メインアプリケーション
 * ```
 *
 * ## 主要クラスの責務
 *
 * ### Entity（エンティティ）
 * - ドメインモデルを表現
 * - ビジネスルールを含む
 * - 不変性を保証（readonly、バリデーション）
 *
 * ### Repository（リポジトリ）
 * - データベースアクセスを抽象化
 * - CRUD操作を提供
 * - SQLの詳細を隠蔽
 *
 * ### Service（サービス）
 * - ビジネスロジックを実装
 * - 複数のリポジトリを組み合わせる
 * - トランザクション管理
 *
 * ### Controller（コントローラー）
 * - HTTPリクエストを処理
 * - サービスを呼び出す
 * - ビューにデータを渡す
 *
 * ## セキュリティのベストプラクティス
 *
 * ### 1. 認証
 * - パスワードハッシュ化（password_hash）
 * - セッションの安全な管理
 * - セッション固定化攻撃対策
 *
 * ### 2. 認可
 * - ユーザーごとの権限チェック
 * - リソース所有者の確認
 *
 * ### 3. XSS対策
 * - すべての出力をエスケープ（htmlspecialchars）
 * - ヘルパー関数h()の使用
 *
 * ### 4. CSRF対策
 * - すべてのフォームにトークン
 * - トークンの検証
 *
 * ### 5. SQLインジェクション対策
 * - プリペアドステートメントの使用
 * - 入力バリデーション
 *
 * ## 学習のポイント
 *
 * 1. **関心の分離**: 各レイヤーが明確な責務を持つ
 * 2. **依存性の注入**: コンストラクタで依存を渡す
 * 3. **型安全性**: 厳格な型宣言を使用
 * 4. **例外処理**: 適切なエラーハンドリング
 * 5. **テスタビリティ**: 各レイヤーを独立してテスト可能
 *
 * ## 実行方法
 *
 * ```bash
 * php src/Phase4/44_blog_system.php
 * ```
 *
 * ## 発展課題
 *
 * 1. コメント機能の実装
 * 2. いいね機能の追加
 * 3. ページネーションの改善
 * 4. 画像アップロード機能
 * 5. Markdownサポート
 * 6. RSSフィード生成
 * 7. サイトマップ生成
 * 8. キャッシュ機能
 * 9. メール通知
 * 10. 管理画面の構築
 */

require_once __DIR__ . '/../../vendor/autoload.php';

use App\Phase4\BlogSystem\BlogApp;

// アプリケーションを実行
$app = new BlogApp();
$app->run();
$app->showStatistics();
